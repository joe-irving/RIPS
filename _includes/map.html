<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
<div class="Map Full" id="prison-map"></div>
<script type="text/javascript">
  {% assign fields = "title,url,lat,lng,rebels_inside" | split: "," %}
  {% assign prisons = site.prisons | where: "used", 1  %}
  var prisons = [{% for p in prisons %}
    {
      {% for val in fields %}
        {% if val == "rebels_inside" %}
        "rebels": [
          {% for r in p.rebels_inside %}
          {
            "title": "{{ r.title }}",
            "url": "{{ r.url | relative_url }}"
          }{% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
        {% else %}
        "{{val}}": "{{ p[val] }}"
        {% endif %}{% unless forloop.last %},{% endunless %}
      {% endfor %}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}];
</script>
<script src="{{ '/assets/js/map.js' | relative_url }}" charset="utf-8"></script>
